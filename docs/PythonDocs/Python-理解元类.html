<!DOCTYPE html>
<html lang="en">
<html>

<head>
  <meta charset="UTF-8">
  <link href="/.static/css/primer.css" rel="stylesheet" />
  <link rel="stylesheet alternate" href="/.static/css/github-light.css" id="light-hl">
  <link rel="stylesheet alternate" href="/.static/css/github-dark.css" id="dark-hl">

  <title>Python-ç†è§£å…ƒç±».md</title>
</head>

<body id="markdown-body" data-color-mode="light" data-dark-theme="light">
  <div class="
        Box
        md
        js-code-block-container
        Box--responsive
        container-xl
        px-3 px-md-4 px-lg-5
        mt-5
      " id="content">
    <div class="Box-body px-5 pb-5">
      <div class="d-flex flex-column flex-sm-row-reverse">
        <div>
          <button id="theme-button" class="btn" type="button">
            <span id="theme-icon" class="iconify" data-icon="octicon:sun-16"></span>
          </button>
        </div>
      </div>
      <article class="markdown-body entry-content container-lg" itemprop="text">
        <h3><a id="user-content-ä¸€å•¥æ˜¯å…ƒç±»" class="anchor" aria-hidden="true" href="#ä¸€å•¥æ˜¯å…ƒç±»"><span aria-hidden="true" class="octicon octicon-link"></span></a>ä¸€ã€å•¥æ˜¯å…ƒç±»</h3>
<p>â€‹		æœ‰äº›åŒå­¦çœ‹åˆ°è¿™ä¸ªå°±å‚»çœ¼äº†ï¼Œå•¥ä¸œè¥¿ï¼Œæ²¡å•¥æ¦‚å¿µå“¦~</p>
<p>â€‹		äº‹å®ä¸Šç¡®å®å¦‚æ­¤ï¼Œç¬”è€…ä¹Ÿæ˜¯äº‘é‡Œé›¾é‡Œå­¦å®Œdjangoã€flaskå‡ ä¸ªæ¡†æ¶å¹¶å®é™…ä½¿ç”¨åˆ°åº”ç”¨ä¸­ä¹‹åæ‰å›è¿‡å¤´æ¥æ€è€ƒè¿™ä¸ªé—®é¢˜çš„ï¼ˆä¸»è¦æ˜¯è¿™äº›æ¡†æ¶æºç çœ‹ä¸å¤ªæ‡‚ï¼‰ï¼å¥½äº†è¨€å½’æ­£ä¼ ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯å…ƒç±»å‘¢ï¼Ÿ</p>
<p>â€‹		å…ƒç±»æ˜¯åˆ¶é€ ç±»çš„å·¥å‚ï¼Œè¿™æ˜¯<code>æµç•…çš„Python</code>ä¸­çš„åŸè¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨<code>class</code>åˆ›å»ºçš„ç±»å¯¹è±¡ä¸­çš„ç±»æ˜¯ç”±å…ƒç±»åˆ›å»ºçš„ï¼ï¼ï¼ å¥½å®¶ä¼™ï¼ŒçœŸç»•å•Šï¼ˆps:ä¸ªäººç†è§£å°±æ˜¯åˆ›å»ºçš„ç±»çš„æ¨¡å…·ï¼‰ã€‚è€Œæˆ‘ä»¬å¸¸ç”¨çš„<code>type</code>åœ¨è¿™é‡Œèµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼ï¼ï¼ çœ‹æ —å­<g-emoji class="g-emoji" alias="chestnut" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f330.png">ğŸŒ°</g-emoji></p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-v">User</span>():
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>):
        <span class="pl-s1">self</span>.<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s1">name</span>

<span class="pl-s1">user</span> <span class="pl-c1">=</span> <span class="pl-v">User</span>(<span class="pl-s">"å¼ ä¸‰"</span>)

<span class="pl-en">print</span>(<span class="pl-en">type</span>(<span class="pl-s1">user</span>))	<span class="pl-c"># &lt;class '__main__.User'&gt;</span>
<span class="pl-en">print</span>(<span class="pl-en">isinstance</span>(<span class="pl-s1">user</span>, <span class="pl-v">User</span>))	<span class="pl-c"># True</span>
<span class="pl-en">print</span>(<span class="pl-en">type</span>(<span class="pl-v">User</span>))	<span class="pl-c"># &lt;class 'type'&gt;</span>
<span class="pl-en">print</span>(<span class="pl-en">isinstance</span>(<span class="pl-v">User</span>, <span class="pl-s1">type</span>))	<span class="pl-c"># True</span></pre></div>
<p>â€‹		ä¸Šè¿°çš„æ —å­è¡¨æ˜ï¼Œ<code>user</code>æ˜¯<code>User</code>è¿™ä¸ªç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>User</code>å‘¢ï¼Ÿä½•å°åˆä¸æ˜¯<code>type</code>çš„å¯¹è±¡å‘¢ã€‚äº‹å®ä¸Šå…³äº<code>type</code>è¿˜æœ‰ä¸€ç§ç”¨æ³•----<strong>åˆ›å»ºç±»</strong></p>
<h3><a id="user-content-äºŒä½¿ç”¨typeåˆ›å»ºç±»" class="anchor" aria-hidden="true" href="#äºŒä½¿ç”¨typeåˆ›å»ºç±»"><span aria-hidden="true" class="octicon octicon-link"></span></a>äºŒã€ä½¿ç”¨typeåˆ›å»ºç±»</h3>
<p>å…ˆçœ‹æºç </p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>):
    <span class="pl-k">pass</span>

<span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">self</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
    <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">self</span>.<span class="pl-s1">var</span>)

<span class="pl-v">B</span> <span class="pl-c1">=</span> <span class="pl-en">type</span>(<span class="pl-s">"B"</span>, (), {<span class="pl-s">"__init__"</span>: <span class="pl-s1">__init__</span>, <span class="pl-s">"__call__"</span>: <span class="pl-s1">__call__</span>, <span class="pl-s">"var"</span>: <span class="pl-c1">1000</span>})

<span class="pl-k">if</span> <span class="pl-s1">__name__</span> <span class="pl-c1">==</span> <span class="pl-s">'__main__'</span>:
    <span class="pl-s1">b</span> <span class="pl-c1">=</span> <span class="pl-v">B</span>()
    <span class="pl-en">b</span>()</pre></div>
<p>ä¸Šè¿°ä»£ç çš„å†™æ³•å’Œè¿™ä¸ªæ˜¯ç­‰æ•ˆçš„</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-v">B</span>():
    <span class="pl-s1">var</span> <span class="pl-c1">=</span> <span class="pl-c1">100</span>

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>):
        <span class="pl-k">pass</span>

    <span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">self</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">self</span>.<span class="pl-s1">var</span>)</pre></div>
<h3><a id="user-content-ä¸‰æŠ›å‡ºé—®é¢˜å†é—®ä½•ä¸ºå…ƒç±»å¦‚ä½•å…ƒç¼–ç¨‹" class="anchor" aria-hidden="true" href="#ä¸‰æŠ›å‡ºé—®é¢˜å†é—®ä½•ä¸ºå…ƒç±»å¦‚ä½•å…ƒç¼–ç¨‹"><span aria-hidden="true" class="octicon octicon-link"></span></a>ä¸‰ã€æŠ›å‡ºé—®é¢˜ï¼šå†é—®ä½•ä¸ºå…ƒç±»ï¼Ÿå¦‚ä½•å…ƒç¼–ç¨‹ï¼Ÿ</h3>
<p>å…¶å®æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œ<code>type</code>å…¶å®å°±æ˜¯ä¸€ä¸ªå…ƒç±»ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ—¢ç„¶æˆ‘ä»¬æœ‰äº†å…ƒç±»ï¼Œæ€ä¹ˆå…ƒç¼–ç¨‹ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“äº†<code>type</code>å°±æ˜¯å…ƒç±»ï¼Œä½†æ˜¯åˆä¸å¯ä»¥ä¿®æ”¹å®ƒçš„ä»£ç ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»§æ‰¿åˆ›å»ºå±äºæˆ‘ä»¬è‡ªå·±çš„å…ƒç±»ï¼ˆè‡ªå·±çš„æ¨¡å…·ï¼‰ï¼Œçœ‹ä»£ç ï¼š</p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-v">A</span>(<span class="pl-s1">type</span>):
  
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>):
        <span class="pl-en">super</span>().<span class="pl-en">__init__</span>(<span class="pl-s1">name</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>)

    <span class="pl-k">def</span> <span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-k">return</span> <span class="pl-s1">type</span>.<span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>)

    <span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">cls</span>.<span class="pl-s1">var</span>, <span class="pl-s1">cls</span>)
        <span class="pl-s1">obj</span> <span class="pl-c1">=</span> <span class="pl-s1">cls</span>.<span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>)
        <span class="pl-s1">cls</span>.<span class="pl-en">__init__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>)
        <span class="pl-k">return</span> <span class="pl-s1">obj</span>


<span class="pl-c"># ä¸åœ¨ä½¿ç”¨typeåˆ›å»ºç±»ï¼Œæ”¹ç”¨Aåˆ›å»ºBç±»</span>
<span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>):
    <span class="pl-k">pass</span>


<span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">self</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
    <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">self</span>.<span class="pl-s1">var</span>)


<span class="pl-v">B</span> <span class="pl-c1">=</span> <span class="pl-v">A</span>(<span class="pl-s">"B"</span>, (), {<span class="pl-s">"__init__"</span>: <span class="pl-s1">__init__</span>, <span class="pl-s">"__call__"</span>: <span class="pl-s1">__call__</span>, <span class="pl-s">"var"</span>: <span class="pl-c1">10000</span>})</pre></div>
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°†<code>A</code>ç»§æ‰¿<code>type</code>,è¿™æ ·å°±å˜æˆäº†ä¸€ä¸ªå…ƒç±»ï¼Œæˆ–è€…è¯´è¶…ç±»ï¼Œå…¶å®æˆ‘æ›´æ„¿æ„å°†å…¶ç†è§£ä¸ºè¿™æ ·çš„ä¸€ä¸ªå†…å®¹ï¼š</p>
<p>â€‹		typeå¯ä»¥åˆ›å»ºç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ¨¡å…·ï¼Œåœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œé€šè¿‡Aä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œå…¶å®å¯ä»¥æ¢ç§æ€ç»´ç†è§£ä¸ºAä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡å…·ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯æ‰¾typeè¿™ä¸ªæ¨¡å…·å¸®å¿™äº†ï¼Œéœ€è¦åšä¸€äº›ç»†æ´»ï¼Œæœ€ç»ˆå®Œæˆä¸€ä¸ªç±»çš„åˆ›å»ºã€‚</p>
<p><strong>æ³¨æ„ç‚¹</strong> :</p>
<p>â€‹		å…¶å®åˆ°ç°åœ¨å¾ˆå¤šåŒå­¦æ²¡æœ‰æ³¨æ„åˆ°äº‹æƒ…çš„éªŒè¯æ€§ï¼Œè‹¥æ˜¯æœ‰åŒå­¦ä½¿ç”¨<code>B</code>æ¥åˆå§‹åŒ–ä¸€ä¸ªå®ä¾‹å°±ä¼šå‘ç°ï¼Œæˆ‘ä»¬çš„è¿™ä¸ªç±»å°†ä¼šè°ƒç”¨<code>A</code>è¿™ä¸ªå…ƒç±»çš„<code>__call__</code>æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™å°±ä¼šæœ‰åŒå­¦é—®äº†ï¼Œè¿™æ˜¯ä¸ºå•¥ï¼Ÿäº‹å®ä¸Šè¦æ˜¯æœ‰åŒå­¦ä»”ç»†è°ƒè¯•ç¨‹åºå°±ä¼šå‘ç°ï¼Œè¿™é‡Œçš„<code>B</code>è¿™ä¸ªç±»å¯¹è±¡å…¶å®æ˜¯<code>A</code>çš„å¯¹è±¡ï¼Œå½“å…¶è°ƒç”¨B()å¼€å§‹åˆå§‹åŒ–çš„æ—¶å€™å°±ä¼šè°ƒç”¨ç±»çš„<code>__call__</code>æ–¹æ³•ï¼ˆps:å¯¹è±¡åŠ ()å°±ä¼šè°ƒç”¨ç±»çš„<code>__call__</code>æ–¹æ³•ï¼Œè¿™æ˜¯åŸºç¡€å“¦~ ï¼‰å®Œæˆå¯¹<code>B</code>ç±»å¯¹è±¡çš„åˆå§‹åŒ–å·¥ä½œã€‚</p>
<h3><a id="user-content-å››æœ‰é—®æœ‰ç®€åŒ–å†™æ³•" class="anchor" aria-hidden="true" href="#å››æœ‰é—®æœ‰ç®€åŒ–å†™æ³•"><span aria-hidden="true" class="octicon octicon-link"></span></a>å››ã€æœ‰é—®æœ‰ç®€åŒ–å†™æ³•ï¼Ÿ</h3>
<p>åˆ«è¯´ï¼Œè¿˜çœŸå°±æœ‰å“¦ï¼Œä½¿ç”¨<code>metaclass</code>å³å¯ï¼Œæ•ˆæœå’Œä¸Šé¢çš„ä¸€è‡´ï¼Œçœ‹æºç </p>
<div class="highlight highlight-source-python"><pre><span class="pl-k">class</span> <span class="pl-v">A</span>(<span class="pl-s1">type</span>):
  
    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>):
        <span class="pl-en">super</span>().<span class="pl-en">__init__</span>(<span class="pl-s1">name</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>)

    <span class="pl-k">def</span> <span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-k">return</span> <span class="pl-s1">type</span>.<span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>)

    <span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">cls</span>.<span class="pl-s1">var</span>, <span class="pl-s1">cls</span>)
        <span class="pl-s1">obj</span> <span class="pl-c1">=</span> <span class="pl-s1">cls</span>.<span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>)
        <span class="pl-s1">cls</span>.<span class="pl-en">__init__</span>(<span class="pl-s1">cls</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>)
        <span class="pl-k">return</span> <span class="pl-s1">obj</span>


<span class="pl-k">class</span> <span class="pl-v">C</span>(<span class="pl-s1">metaclass</span><span class="pl-c1">=</span><span class="pl-v">A</span>):
    <span class="pl-s1">var</span> <span class="pl-c1">=</span> <span class="pl-c1">2000</span>

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>):
        <span class="pl-k">pass</span>

    <span class="pl-k">def</span> <span class="pl-en">__call__</span>(<span class="pl-s1">self</span>, <span class="pl-c1">*</span><span class="pl-s1">args</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-en">print</span>(<span class="pl-s1">args</span>, <span class="pl-s1">kwargs</span>, <span class="pl-s1">self</span>.<span class="pl-s1">var</span>)</pre></div>
<h3><a id="user-content-äº”å°ç»“" class="anchor" aria-hidden="true" href="#äº”å°ç»“"><span aria-hidden="true" class="octicon octicon-link"></span></a>äº”ã€å°ç»“</h3>
<p>â€‹		ä¸€èˆ¬çš„ï¼Œåœ¨åˆ›å»ºç±»æ—¶ï¼Œé¦–å…ˆèµ°çš„æ˜¯<code>__new__</code> --&gt; <code>__init__</code>åœ¨ä¸Šè¿°çš„ä¾‹å­ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªæ™®é€šç±»ä¹‹å‰ï¼Œæˆ‘ä»¬çš„å…ƒç±»ä¼šå…ˆåˆ›å»ºä¸€ä¸ªç±»ï¼Œæ²¡é”™ï¼Œå°±æ˜¯ä¸€ä¸ªç±»ï¼Œåœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œå°†ä¼šæ‰§è¡Œå…ƒç±»çš„<code>__new__</code>æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œå…ƒç±»çš„<code>__init__</code>æ–¹æ³•ä»¥æ­¤æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„ç±»ï¼Œå½“è¿™ä¸ªç±»å¼€å§‹å®ä¾‹åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨å…ƒç±»çš„<code>__call__</code>æ–¹æ³•ï¼ŒåŸå› å°±åœ¨è¿™é‡Œ<code>print(type(B))</code>ç»“æœä¸º<code># &lt;class '__main__.A'&gt;</code>ï¼Œè¯´æ˜å…¶å®æˆ‘ä»¬è¿™é‡Œçš„Bç›®å‰è¿˜åªæ˜¯Açš„ä¸€ä¸ªå¯¹è±¡ï¼Œå®Œå…¨å¯ä»¥è°ƒç”¨Açš„<code>__call__</code>æ–¹æ³•ï¼Œåœ¨è¿™ä¸ª<code>__call__</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¾—åˆ°çš„clså‚æ•°å°±å˜æˆäº†Bè¿™ä¸ªç±»ï¼Œç”±æ­¤åˆ†åˆ«è°ƒç”¨Bç±»çš„<code>__new__</code>æ–¹æ³•å’Œ<code>__init__</code>æ–¹æ³•ï¼Œå®ç°å®ä¾‹åŒ–ã€‚</p>
<p>â€‹		æ‰€ä»¥å®ä¾‹åŒ–å¯¹è±¡è¿‡ç¨‹çš„é¡ºåºï¼š</p>
<p>â€‹    	å…ƒç±»<code>__new__</code>æ–¹æ³• --&gt; å…ƒç±»<code>__init__</code>æ–¹æ³• --&gt; å…ƒç±»<code>__call__</code>æ–¹æ³• --&gt; æ™®é€šç±»<code>__new__</code>æ–¹æ³• --&gt; æ™®é€šç±»<code>__init__</code>æ–¹æ³•</p>
<h3><a id="user-content-å…­åº”ç”¨åœºæ™¯" class="anchor" aria-hidden="true" href="#å…­åº”ç”¨åœºæ™¯"><span aria-hidden="true" class="octicon octicon-link"></span></a>å…­ã€åº”ç”¨åœºæ™¯</h3>
<p>â€‹		djangoçš„ormï¼Œwtf-formsç­‰ç­‰ã€‚</p>
<h3><a id="user-content-ä¸ƒdemo" class="anchor" aria-hidden="true" href="#ä¸ƒdemo"><span aria-hidden="true" class="octicon octicon-link"></span></a>ä¸ƒã€demo</h3>
<p>æ¨¡æ‹Ÿdjango-ormå°è¯•demo</p>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># PythonDocs/src/PythonMetaClass/fields.py</span>

<span class="pl-k">class</span> <span class="pl-v">Field</span>():

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>, <span class="pl-s1">column_type</span>):
        <span class="pl-s1">self</span>.<span class="pl-s1">name</span> <span class="pl-c1">=</span> <span class="pl-s1">name</span>
        <span class="pl-s1">self</span>.<span class="pl-s1">column_type</span> <span class="pl-c1">=</span> <span class="pl-s1">column_type</span>

    <span class="pl-k">def</span> <span class="pl-en">__str__</span>(<span class="pl-s1">self</span>):
        <span class="pl-k">return</span> <span class="pl-s">"{} type is {}"</span>.<span class="pl-en">format</span>(<span class="pl-s1">self</span>.<span class="pl-s1">name</span>, <span class="pl-s1">self</span>.<span class="pl-s1">column_type</span>)


<span class="pl-k">class</span> <span class="pl-v">IntField</span>(<span class="pl-v">Field</span>):

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>):
        <span class="pl-en">super</span>(<span class="pl-v">IntField</span>, <span class="pl-s1">self</span>).<span class="pl-en">__init__</span>(<span class="pl-s1">name</span>, <span class="pl-s">"int"</span>)


<span class="pl-k">class</span> <span class="pl-v">StringField</span>(<span class="pl-v">Field</span>):

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">name</span>):
        <span class="pl-en">super</span>(<span class="pl-v">StringField</span>, <span class="pl-s1">self</span>).<span class="pl-en">__init__</span>(<span class="pl-s1">name</span>, <span class="pl-s">"varchar(250)"</span>)</pre></div>
<div class="highlight highlight-source-python"><pre><span class="pl-c"># PythonDocs/src/PythonMetaClass/orm.py</span>

<span class="pl-k">from</span> .<span class="pl-s1">fields</span> <span class="pl-k">import</span> <span class="pl-v">Field</span>, <span class="pl-v">IntField</span>, <span class="pl-v">StringField</span>


<span class="pl-k">class</span> <span class="pl-v">Orm</span>(<span class="pl-s1">type</span>):

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">names</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>):
        <span class="pl-en">super</span>().<span class="pl-en">__init__</span>(<span class="pl-s1">names</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>)

    <span class="pl-en">@<span class="pl-s1">staticmethod</span></span>
    <span class="pl-k">def</span> <span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-s1">names</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>):
        <span class="pl-k">if</span> <span class="pl-s1">names</span> <span class="pl-c1">!=</span> <span class="pl-s">"Model"</span>:
            <span class="pl-s1">mapping</span> <span class="pl-c1">=</span> {}
            <span class="pl-k">for</span> <span class="pl-s1">dic_k</span>, <span class="pl-s1">dic_v</span> <span class="pl-c1">in</span> <span class="pl-s1">dicts</span>.<span class="pl-en">items</span>():
                <span class="pl-k">if</span> <span class="pl-en">isinstance</span>(<span class="pl-s1">dic_v</span>, <span class="pl-v">Field</span>):
                    <span class="pl-s1">mapping</span>[<span class="pl-s1">dic_k</span>] <span class="pl-c1">=</span> <span class="pl-s1">dic_v</span>

            <span class="pl-c"># å‰”é™¤ç±»å±æ€§</span>
            <span class="pl-k">for</span> <span class="pl-s1">k</span> <span class="pl-c1">in</span> <span class="pl-s1">mapping</span>:
                <span class="pl-s1">dicts</span>.<span class="pl-en">pop</span>(<span class="pl-s1">k</span>)

            <span class="pl-s1">dicts</span>[<span class="pl-s">"__mapping__"</span>] <span class="pl-c1">=</span> <span class="pl-s1">mapping</span>
            <span class="pl-s1">dicts</span>[<span class="pl-s">"__tablename__"</span>] <span class="pl-c1">=</span> <span class="pl-s1">names</span>.<span class="pl-en">lower</span>()

        <span class="pl-k">return</span> <span class="pl-s1">type</span>.<span class="pl-en">__new__</span>(<span class="pl-s1">cls</span>, <span class="pl-s1">names</span>, <span class="pl-s1">bases</span>, <span class="pl-s1">dicts</span>)


<span class="pl-k">class</span> <span class="pl-v">Model</span>(<span class="pl-s1">dict</span>, <span class="pl-s1">metaclass</span><span class="pl-c1">=</span><span class="pl-v">Orm</span>):

    <span class="pl-k">def</span> <span class="pl-en">__init__</span>(<span class="pl-s1">self</span>, <span class="pl-c1">**</span><span class="pl-s1">kwargs</span>):
        <span class="pl-en">super</span>().<span class="pl-en">__init__</span>(<span class="pl-c1">**</span><span class="pl-s1">kwargs</span>)

    <span class="pl-k">def</span> <span class="pl-en">__setattr__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">key</span>, <span class="pl-s1">value</span>):
        <span class="pl-s1">self</span>[<span class="pl-s1">key</span>] <span class="pl-c1">=</span> <span class="pl-s1">value</span>

    <span class="pl-k">def</span> <span class="pl-en">__getattr__</span>(<span class="pl-s1">self</span>, <span class="pl-s1">item</span>):
        <span class="pl-k">return</span> <span class="pl-s1">self</span>[<span class="pl-s1">item</span>]

    <span class="pl-k">def</span> <span class="pl-en">save</span>(<span class="pl-s1">self</span>):
        <span class="pl-en">print</span>(<span class="pl-s">"save model"</span>)

        <span class="pl-s1">field</span> <span class="pl-c1">=</span> []
        <span class="pl-s1">values</span> <span class="pl-c1">=</span> []
        <span class="pl-k">for</span> <span class="pl-s1">_field</span>, <span class="pl-s1">_values</span> <span class="pl-c1">in</span> <span class="pl-s1">self</span>.<span class="pl-s1">__mapping__</span>.<span class="pl-en">items</span>():
            <span class="pl-s1">field</span>.<span class="pl-en">append</span>(<span class="pl-s1">_field</span>)
            <span class="pl-s1">values</span>.<span class="pl-en">append</span>(<span class="pl-en">str</span>(<span class="pl-en">getattr</span>(<span class="pl-s1">self</span>, <span class="pl-s1">_field</span>, <span class="pl-c1">None</span>)))

        <span class="pl-s1">sql</span> <span class="pl-c1">=</span> <span class="pl-s">"insert into %s (%s) values (%s);"</span> <span class="pl-c1">%</span> (<span class="pl-s1">self</span>.<span class="pl-s1">__tablename__</span>, <span class="pl-s">','</span>.<span class="pl-en">join</span>(<span class="pl-s1">field</span>), <span class="pl-s">','</span>.<span class="pl-en">join</span>(<span class="pl-s1">values</span>))
        <span class="pl-en">print</span>(<span class="pl-s1">sql</span>)


<span class="pl-k">class</span> <span class="pl-v">UserInfo</span>(<span class="pl-v">Model</span>):
    <span class="pl-s1">username</span> <span class="pl-c1">=</span> <span class="pl-v">StringField</span>(<span class="pl-s">"username"</span>)
    <span class="pl-s1">age</span> <span class="pl-c1">=</span> <span class="pl-v">IntField</span>(<span class="pl-s">"age"</span>)


<span class="pl-k">if</span> <span class="pl-s1">__name__</span> <span class="pl-c1">==</span> <span class="pl-s">'__main__'</span>:
    <span class="pl-s1">user</span> <span class="pl-c1">=</span> <span class="pl-v">UserInfo</span>(<span class="pl-s1">username</span><span class="pl-c1">=</span><span class="pl-s">"å¼ ä¸‰"</span>, <span class="pl-s1">age</span><span class="pl-c1">=</span><span class="pl-c1">24</span>)
    <span class="pl-s1">user</span>.<span class="pl-en">save</span>()</pre></div>
<h3><a id="user-content-å¼•è¨€" class="anchor" aria-hidden="true" href="#å¼•è¨€"><span aria-hidden="true" class="octicon octicon-link"></span></a>å¼•è¨€</h3>
<blockquote>
<p>ä¸è¦åœ¨ç”Ÿäº§ä»£ç ä¸­å®šä¹‰æŠ½è±¡åŸºç±»ï¼ˆæˆ–å…ƒç±»ï¼‰â€¦â€¦å¦‚æœä½ å¾ˆæƒ³ è¿™æ ·åšï¼Œæˆ‘æ‰“èµŒå¯èƒ½æ˜¯å› ä¸ºä½ æƒ³â€œæ‰¾èŒ¬â€ï¼Œåˆšæ‹¿åˆ°æ–°å·¥å…·çš„äººéƒ½æœ‰å¤§ å¹²ä¸€åœºçš„å†²åŠ¨ã€‚å¦‚æœä½ èƒ½é¿å¼€è¿™äº›æ·±å¥¥çš„æ¦‚å¿µï¼Œä½ ï¼ˆä»¥åŠæœªæ¥çš„ä»£ ç ç»´æŠ¤è€…ï¼‰çš„ç”Ÿæ´»å°†æ›´æ„‰å¿«ï¼Œå› ä¸ºä»£ç ç®€æ´æ˜äº†ã€‚</p>
<p>â€‹																																																										 â€”â€”Alex Martelli</p>
</blockquote>

      </article>
    </div>
  </div>
  <script src="/.static/js/theme.js"></script>
  <script src="/.static/js/iconify.min.js"></script>
</body>

</html>